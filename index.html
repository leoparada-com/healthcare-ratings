<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calificaciones de Profesionales de Salud (1–7)</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="src/static/css/styles.css" />

  <!-- Iconos -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
        referrerpolicy="no-referrer" />

  <!-- Charts (para Ranking) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <meta name="theme-color" content="#1657c1">
  <meta name="description" content="Simulación (sin backend) para calificar profesionales de salud (1–7) y ver ranking.">
</head>
<body>
  <!-- Franja superior (solo azul y rojo) -->
  <div class="franja-chile"></div>

  <header>
    <div class="wrap row" style="justify-content:space-between">
      <div class="brand">Calificaciones de Profesionales de Salud (1–7)</div>
      <nav class="row">
        <!-- History API: simula cambio real de página -->
        <a class="btn ghost navlink" href="?page=inicio" data-link>Inicio</a>
        <a class="btn ghost navlink" href="?page=ranking" data-link>Ranking</a>
        <button class="btn ghost navlink" id="btnReset" title="Regenerar datos simulados">Reset</button>
      </nav>
    </div>
  </header>

  <main class="wrap" style="padding:18px 16px">
    <!-- =================== VISTA: INICIO =================== -->
    <section id="view-inicio" class="view active">
      <div class="panel grid">
        <header class="intro">
          <div class="title">Califica profesionales de salud</div>
          <div class="muted">
            Selecciona una nota (1–7) para cada profesional y presiona <b>Enviar calificaciones</b>.
            Los promedios y votos se actualizarán al instante.
          </div>
        </header>

        <!-- Grupo: Atención Primaria -->
        <section class="group-section cap-primaria" aria-labelledby="h-primaria">
          <div class="cap cap-primaria">
            <span class="cap-icon"><i class="fa-solid fa-hand-holding-medical"></i></span>
            <h2 id="h-primaria" class="cap-title cap-title-primaria">Atención Primaria</h2>
          </div>
          <div class="cards-row" id="cards-Primaria"></div>
        </section>

        <!-- Grupo: Atención Secundaria -->
        <section class="group-section cap-secundaria" aria-labelledby="h-secundaria">
          <div class="cap cap-secundaria">
            <span class="cap-icon"><i class="fa-solid fa-stethoscope"></i></span>
            <h2 id="h-secundaria" class="cap-title cap-title-secundaria">Atención Secundaria</h2>
          </div>
          <div class="cards-row" id="cards-Secundaria"></div>
        </section>

        <!-- Grupo: Atención Terciaria -->
        <section class="group-section cap-terciaria" aria-labelledby="h-terciaria">
          <div class="cap cap-terciaria">
            <span class="cap-icon"><i class="fa-solid fa-hospital-user"></i></span>
            <h2 id="h-terciaria" class="cap-title cap-title-terciaria">Atención Terciaria</h2>
          </div>
          <div class="cards-row" id="cards-Terciaria"></div>
        </section>

        <div class="controls">
          <div class="row" style="justify-content:space-between">
            <div class="muted">Solo se envían las tarjetas donde elegiste una nota.</div>
            <div class="row">
              <button id="btnClear" class="btn">Limpiar selecciones</button>
              <button id="btnSubmit" class="btn primary">Enviar calificaciones</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">Notas de 1 a 7 · Simulación local · Sin backend</div>
    </section>

    <!-- =================== VISTA: RANKING =================== -->
    <section id="view-ranking" class="view">
      <div class="panel grid">
        <div>
          <div class="title">
            <i class="fa-solid fa-trophy" aria-hidden="true"></i>&nbsp;Ranking de Profesionales
          </div>
          <div class="muted">
            Se separa entre quienes <b>ya tienen calificaciones</b> y quienes <b>aún no</b>.
            Arriba verás la distribución de promedios cuando existan calificaciones.
            Puedes volver a <a class="navlink" href="?page=inicio" data-link>calificar</a>.
          </div>
          <div class="muted" id="voteHint" style="margin-top:8px; display:none">
            Se destacan con borde los profesionales que votaste en tu último envío.
          </div>
        </div>

        <!-- Panel de gráficos (se oculta si no hay datos) -->
        <div class="panel" style="padding:16px" id="chartsPanel" hidden>
          <div class="title" style="margin-bottom:8px">
            <i class="fa-solid fa-chart-column" aria-hidden="true"></i>&nbsp;Distribución de calificaciones
          </div>
          <div class="charts" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="bar-wrap"><canvas id="histChart" aria-label="Histograma" role="img"></canvas></div>
            <div class="pie-wrap"><canvas id="pieChart" aria-label="Torta de distribución" role="img"></canvas></div>
          </div>
          <div class="muted" style="margin-top:8px; font-size:13px">
            Total con calificación: <b id="distTotal">0</b> profesionales.
          </div>
        </div>

        <h2 class="cap-title" style="margin:12px 0 0">Con calificaciones</h2>
        <table class="table" style="width:100%; border-collapse:collapse; margin-top:8px">
          <thead>
            <tr>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">#</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">Profesional</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">Nivel</th>
              <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border)">Promedio</th>
              <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border)">Votos</th>
            </tr>
          </thead>
          <tbody id="tbodyRated"></tbody>
        </table>

        <h2 class="cap-title" style="margin:18px 0 0">Aún sin calificaciones</h2>
        <div class="muted" style="margin:4px 0 8px">Estos profesionales todavía no tienen votos registrados.</div>
        <table class="table" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">#</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">Profesional</th>
              <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border)">Nivel</th>
              <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border)">Estado</th>
            </tr>
          </thead>
          <tbody id="tbodyUnrated"></tbody>
        </table>
      </div>

      <div class="footer">Distribución, tabla y resaltado de tu último voto (simulación)</div>
    </section>
  </main>

  <!-- Modal de envío (simulación de espera) -->
  <div id="submitModal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="row" style="justify-content:center;gap:10px;margin-bottom:8px">
        <i class="fa-solid fa-spinner fa-spin" aria-hidden="true"></i>
        <strong>Enviando tus calificaciones…</strong>
      </div>
      <div class="muted">Esto puede tardar unos segundos.</div>
    </div>
  </div>

  <noscript>Esta aplicación requiere JavaScript para funcionar correctamente.</noscript>

  <!-- JS principal (incluye router por History API, bloqueo de ranking hasta enviar y modal de espera) -->
  <script defer src="src/static/js/main.js"></script>
</body>
</html>
